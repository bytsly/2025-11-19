# 管理后台登录功能说明

## 功能概述

管理后台现已添加账号密码登录验证功能，确保只有授权用户才能访问和操作管理功能。

## 默认账号信息

- **用户名**: `admin`
- **密码**: `admin123`

## 功能特性

### 1. 登录保护
- 访问 `/admin` 时自动检查登录状态
- 未登录用户会自动跳转到登录页面
- 登录成功后才能访问管理后台

### 2. 会话管理
- 使用 Flask Session 管理登录状态
- 登录后可持续访问，无需重复登录
- 支持退出登录功能

### 3. API 保护
以下 API 接口已添加登录验证：
- ✅ 候选人管理（增删改查）
- ✅ 照片上传
- ✅ 投票重置
- ✅ 抽奖功能
- ✅ WiFi热点管理

### 4. 安全特性
- 密码输入框支持显示/隐藏切换
- 登录失败提示错误信息
- 未授权请求自动跳转登录页
- Session 密钥加密保护

## 自定义账号密码

### 方法一：环境变量（推荐）

创建或编辑 `.env` 文件：

```env
ADMIN_USERNAME=your_username
ADMIN_PASSWORD=your_password
```

### 方法二：修改配置文件

编辑 `backend/config.py`：

```python
class Config:
    # 管理员账号配置
    ADMIN_USERNAME = os.getenv('ADMIN_USERNAME', 'your_username')
    ADMIN_PASSWORD = os.getenv('ADMIN_PASSWORD', 'your_password')
```

## 使用流程

### 1. 启动系统
```bash
# 使用 GUI 窗口
python gui_app.py

# 或使用命令行
python run.py
```

### 2. 访问管理后台
- 打开浏览器访问 `http://localhost:5000/admin`
- 系统会自动跳转到登录页面

### 3. 登录
- 输入用户名和密码
- 点击"登录"按钮
- 登录成功后自动跳转到管理后台

### 4. 退出登录
- 点击页面右上角的"退出登录"按钮
- 确认后返回登录页面

## 页面路由

| 路由 | 功能 | 是否需要登录 |
|------|------|-------------|
| `/admin/login` | 登录页面 | ❌ |
| `/admin` | 管理后台 | ✅ |
| `/vote` | 投票页面 | ❌ |
| `/lottery` | 抽奖页面 | ❌ |

## API 接口

### 登录相关

#### POST `/api/admin/login`
登录接口

**请求体**:
```json
{
  "username": "admin",
  "password": "admin123"
}
```

**响应**:
```json
{
  "success": true,
  "message": "登录成功",
  "data": {
    "username": "admin"
  }
}
```

#### POST `/api/admin/logout`
退出登录

**响应**:
```json
{
  "success": true,
  "message": "登出成功"
}
```

#### GET `/api/admin/check-auth`
检查登录状态

**响应**:
```json
{
  "success": true,
  "data": {
    "logged_in": true,
    "username": "admin"
  }
}
```

## 安全建议

1. **修改默认密码**: 首次使用后请立即修改默认账号密码
2. **使用强密码**: 建议密码至少 8 位，包含字母、数字和特殊字符
3. **环境变量**: 生产环境中使用环境变量而不是硬编码
4. **HTTPS**: 生产环境建议使用 HTTPS 加密传输
5. **定期更换**: 定期更换管理员密码

## 故障排查

### 无法登录
1. 检查用户名和密码是否正确
2. 检查配置文件中的账号设置
3. 检查浏览器控制台是否有错误信息

### 自动退出
1. 检查 Flask Session 配置
2. 检查 SECRET_KEY 是否设置
3. 清除浏览器 Cookie 后重试

### 401 未授权错误
1. 确认已登录
2. 刷新页面重新登录
3. 检查 Session 是否过期

## 技术实现

- **后端**: Flask Session + 装饰器验证
- **前端**: JavaScript fetch API + 自动跳转
- **加密**: Flask SECRET_KEY 加密 Session
- **验证**: 每个受保护的 API 都使用 `@login_required` 装饰器

## 相关文件

```
backend/
├── config.py                 # 账号密码配置
├── routes/
│   └── admin.py             # 登录验证逻辑
└── app.py                   # Session 配置

frontend/
└── admin/
    ├── login.html           # 登录页面
    ├── index.html           # 管理后台
    └── script.js            # 前端验证逻辑
```

## 更新日志

- **2025-10-17**: 添加账号密码登录功能
  - 新增登录页面
  - 添加 Session 管理
  - 保护所有管理 API
  - 添加退出登录功能
