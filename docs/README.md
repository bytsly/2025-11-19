# 🎉 投票抽奖系统

一个功能强大的投票与抽奖管理系统，使用 Python + Flask 开发，支持多种候选人导入方式、实时投票统计、WiFi热点生成和炫酷的抽奖动画。

## 🆕 v2.0 更新 - GUI窗口模式

**现在支持两种运行模式：**

### 🖥️ GUI窗口模式（推荐）
- ✅ 友好的图形界面，无黑色命令行窗口
- ✅ 一键启动/停止服务
- ✅ 快速访问各功能页面
- ✅ 实时查看运行日志
- ✅ 支持日志导出
- ✅ 适合所有用户，无需技术背景

**快速启动：**
```bash
# 开发环境
python gui_app.py
# 或双击运行：启动GUI.bat

# 生产环境（打包后）
双击运行：投票抽奖系统.exe
```

### 💻 终端模式（开发者）
- 传统的命令行启动方式
- 适合开发和调试

**快速启动：**
```bash
python run.py
```

> 📖 **详细说明**：查看 [`窗口模式快速指南.md`](窗口模式快速指南.md) 了解GUI模式的完整使用方法

## ✨ 主要功能

### 📊 投票功能
- **多种导入方式**: 支持Excel/CSV文件导入、照片OCR识别导入
- **防重复投票**: 基于IP + 设备指纹的防刷机制
- **实时统计**: WebSocket实时推送投票数据
- **响应式设计**: 完美适配手机、平板、电脑
- **数据导出**: 一键导出投票结果为Excel

### 🎁 抽奖功能
- **炫酷动画**: 照片快速轮播抽奖效果
- **灵活配置**: 可设置抽奖人数、奖项名称
- **排除机制**: 可选择是否排除已中奖者
- **历史记录**: 完整的抽奖历史记录
- **大屏展示**: 适合投影展示的抽奖界面

### 📡 网络功能
- **WiFi热点**: 一键创建WiFi热点供他人连接
- **二维码生成**: 自动生成投票页面二维码
- **局域网支持**: 支持同一局域网内访问

### 👥 候选人管理
- **手动添加**: 表单添加候选人信息
- **批量导入**: Excel/CSV批量导入
- **照片识别**: OCR识别照片中的姓名
- **照片管理**: 上传和管理候选人照片

## 🚀 快速开始

### 环境要求

- Python 3.9 或更高版本
- Windows 操作系统（WiFi热点功能需要）
- 管理员权限（创建WiFi热点时需要）

### 安装步骤

#### 1. 克隆或下载项目

```bash
cd d:\编程\源码包\投票抽奖系统
```

#### 2. 创建虚拟环境（推荐）

```bash
python -m venv venv
venv\Scripts\activate
```

#### 3. 安装依赖

```bash
pip install -r requirements.txt
```

**注意**: PaddleOCR安装可能较慢，如果不需要OCR功能，可以跳过paddleocr和paddlepaddle的安装。

#### 4. 配置环境变量（可选）

复制 `.env.example` 为 `.env` 并修改配置：

```bash
copy .env.example .env
```

#### 5. 运行应用

```bash
python run.py
```

### 首次运行

1. 启动后访问: `http://localhost:5000`
2. 进入管理后台: `http://localhost:5000/admin`
3. 添加候选人（手动添加或导入文件）
4. 开始投票或抽奖！

## 📖 使用指南

### 候选人导入

#### 方式1: Excel/CSV导入

准备Excel文件，格式如下：

| 姓名   | 描述         |
|--------|-------------|
| 张三   | 优秀员工     |
| 李四   | 销售冠军     |
| 王五   | 技术专家     |

在管理后台 -> 候选人管理 -> 文件导入，选择Excel文件上传。

#### 方式2: 照片OCR识别

1. 准备包含姓名的照片（如名单截图）
2. 在管理后台 -> 候选人管理 -> 照片识别
3. 系统会自动识别照片中的中文姓名
4. 手动确认并添加候选人

#### 方式3: 手动添加

在管理后台 -> 候选人管理 -> 手动添加，填写表单。

### 创建WiFi热点

1. 进入管理后台 -> 网络设置
2. 设置热点名称（SSID）和密码
3. 点击"创建热点"按钮
4. **需要管理员权限**，如果失败请以管理员身份运行程序
5. 生成二维码供投票者扫描

### 投票流程

1. 投票者扫描二维码或访问投票地址
2. 浏览候选人列表
3. 点击选择候选人（卡片会高亮）
4. 点击"确认投票"按钮
5. 系统自动防止重复投票

### 抽奖流程

#### 在管理后台抽奖：

1. 进入管理后台 -> 抽奖管理
2. 设置抽奖人数和奖项名称
3. 选择是否排除已中奖者
4. 点击"开始抽奖"按钮
5. 系统随机抽取并显示中奖者

#### 使用抽奖大屏：

1. 点击"打开抽奖大屏"或访问 `/lottery`
2. 点击"开始抽奖"或按空格键
3. 照片开始快速轮播
4. 再次点击或按空格键停止
5. 显示中奖者并播放彩纸动画

## 📁 项目结构

```
投票抽奖系统/
├── backend/                    # 后端代码
│   ├── models/                # 数据模型
│   │   ├── candidate.py       # 候选人模型
│   │   ├── vote.py           # 投票记录模型
│   │   └── lottery.py        # 抽奖记录模型
│   ├── routes/                # 路由
│   │   ├── admin.py          # 管理后台API
│   │   ├── vote.py           # 投票API
│   │   └── lottery.py        # 抽奖API
│   ├── services/              # 业务服务
│   │   ├── ocr_service.py    # OCR识别
│   │   ├── hotspot_service.py # WiFi热点
│   │   ├── qrcode_service.py # 二维码生成
│   │   ├── vote_service.py   # 投票服务
│   │   ├── file_service.py   # 文件处理
│   │   └── lottery_service.py # 抽奖服务
│   ├── utils/                 # 工具函数
│   ├── app.py                # Flask应用
│   └── config.py             # 配置文件
├── frontend/                  # 前端页面
│   ├── admin/                # 管理后台
│   ├── vote/                 # 投票页面
│   └── lottery/              # 抽奖页面
├── uploads/                   # 上传文件（自动创建）
├── database/                  # 数据库文件（自动创建）
├── requirements.txt          # Python依赖
├── run.py                    # 启动脚本
└── README.md                 # 本文件
```

## ⚙️ 配置说明

### 环境变量（.env文件）

```env
# Flask配置
FLASK_ENV=development
SECRET_KEY=your-secret-key

# 数据库
DATABASE_URL=sqlite:///database/voting.db

# WiFi热点
HOTSPOT_SSID=VotingSystem
HOTSPOT_PASSWORD=12345678

# 服务器
HOST=0.0.0.0
PORT=5000
```

### 投票配置

在 `backend/config.py` 中可以修改：

- `VOTE_LIMIT_PER_IP`: 每个IP最多投票次数（默认1次）
- `VOTE_SESSION_TIMEOUT`: 投票会话超时时间
- `MAX_CONTENT_LENGTH`: 最大上传文件大小（默认16MB）

## 🔧 常见问题

### 1. WiFi热点创建失败？

**解决方案**:
- 确保以管理员权限运行程序
- 检查无线网卡是否支持热点功能
- 在命令提示符（管理员）中运行：`netsh wlan show drivers` 查看"支持的承载网络"是否为"是"

### 2. OCR识别不准确？

**解决方案**:
- 确保照片清晰，文字足够大
- 照片中的姓名应为2-4个中文字符
- 尽量使用白底黑字的图片
- OCR识别结果仅供参考，建议手动确认

### 3. 无法访问投票页面？

**解决方案**:
- 确保服务器正在运行
- 检查防火墙设置，允许5000端口
- 确保设备连接到同一WiFi或局域网
- 尝试使用IP地址而非localhost

### 4. 投票后无法再次投票？

这是正常行为，系统防止重复投票。如需重置，在管理后台 -> 数据看板 -> 重置投票。

### 5. PaddleOCR安装失败？

如果不需要OCR功能，可以不安装PaddleOCR。系统会自动检测并禁用OCR相关功能。

## 🎨 功能特性

### 防重复投票机制

系统采用多重防护：
1. **IP地址检测**: 记录投票者IP
2. **设备指纹**: 基于Canvas生成唯一设备标识
3. **Session控制**: 服务器端会话管理

### 实时数据更新

使用WebSocket技术，投票和抽奖数据实时推送到所有连接的客户端。

### 数据安全

- SQLite数据库存储，数据持久化
- 文件上传路径安全处理
- SQL注入防护（使用ORM）

## 🚀 高级功能

### 自定义主题

修改各页面的CSS样式文件可自定义界面主题。

### 批量操作

可通过Excel批量导入候选人，支持自定义字段。

### API接口

系统提供完整的RESTful API，可用于二次开发：

- `GET /api/vote/candidates` - 获取候选人列表
- `POST /api/vote/submit` - 提交投票
- `POST /api/lottery/draw` - 执行抽奖
- 更多API见各路由文件

## 📦 打包成EXE

本项目支持打包成Windows可执行文件，无需Python环境即可运行。

### 快速打包

**方式1: 使用批处理脚本（最简单）**

```cmd
# 双击运行
打包exe.bat
```

**方式2: 使用PowerShell脚本**

```powershell
# 右键点击选择 "使用PowerShell运行"
打包exe.ps1
```

**方式3: 手动打包**

```powershell
# 1. 激活虚拟环境
.\venv\Scripts\Activate.ps1

# 2. 安装PyInstaller
pip install pyinstaller

# 3. 执行打包
pyinstaller build_exe.spec --clean

# 4. 打包完成，可执行文件在 dist\投票抽奖系统\
```

### 打包后使用

1. 进入 `dist\投票抽奖系统` 目录
2. 双击运行 `投票抽奖系统.exe`
3. 在浏览器访问 `http://localhost:5000`

### 打包说明

- **打包时间**: 3-5分钟
- **文件大小**: 80-120MB（包含所有依赖）
- **启动时间**: 首次10-20秒
- **详细文档**: 查看 `打包说明.md`

---

## 📝 开发计划

- [ ] 支持多轮投票
- [ ] 微信集成
- [ ] 数据可视化图表
- [ ] 移动端APP
- [ ] 云部署支持

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 📄 许可证

MIT License

## 👨‍💻 技术支持

如有问题，请查看文档或提交Issue。

## 🎯 使用场景

- 公司年会抽奖
- 学校班级评选
- 社区活动投票
- 展会现场互动
- 培训活动抽奖

---

**祝您使用愉快！** 🎉