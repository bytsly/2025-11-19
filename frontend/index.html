<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">æŠ•ç¥¨æŠ½å¥–ç³»ç»Ÿ - é¦–é¡µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            text-align: center;
            color: white;
        }
        
        h1#main-title {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 18px;
            margin-bottom: 50px;
            opacity: 0.9;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }
        
        .button-row {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-button {
            display: inline-block;
            padding: 20px 50px;
            font-size: 20px;
            color: white;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            border-radius: 50px;
            text-decoration: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .nav-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .nav-button.admin {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
        }
        
        .nav-button.admin:hover {
            background: rgba(255, 107, 107, 0.5);
        }
        
        .qrcode-section {
            margin-top: 50px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .qrcode-section h2 {
            font-size: 24px;
            margin-bottom: 20px;
        }
        
        .qrcode-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        
        .qrcode-container img {
            max-width: 250px;
            width: 100%;
            height: auto;
        }
        
        .qrcode-url {
            font-size: 14px;
            word-break: break-all;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .qrcode-button {
            padding: 12px 30px;
            font-size: 16px;
            color: white;
            background: rgba(255, 255, 255, 0.25);
            border: 2px solid white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .qrcode-button:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-2px);
        }
        
        .loading {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .footer {
            position: fixed;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: white;
            opacity: 0.7;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="main-title">ğŸ‰ æŠ•ç¥¨æŠ½å¥–ç³»ç»Ÿ</h1>
        <p class="subtitle">ä¸“ä¸šçš„æŠ•ç¥¨ä¸æŠ½å¥–ç®¡ç†å¹³å°</p>
        
        <div class="button-group">
            <div class="button-row">
                <a href="/vote" class="nav-button">ğŸ—³ï¸ æŠ•ç¥¨é¡µé¢</a>
                <a href="/lottery" class="nav-button">ğŸ æŠ½å¥–ç³»ç»Ÿ</a>
            </div>
            <div class="button-row">
                <a href="/admin" class="nav-button admin">ğŸ“Š ç®¡ç†åå°</a>
            </div>
        </div>
        
        <!-- äºŒç»´ç åŒºåŸŸ -->
        <div class="qrcode-section">
            <h2>ğŸ“± æ‰«ç å‚ä¸æŠ•ç¥¨</h2>
            
            <!-- æ¨¡å¼é€‰æ‹© -->
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px; font-size: 14px;">
                    <input type="radio" name="qrMode" value="combo" checked onchange="updateQRMode()">
                    ğŸ”— WiFi + æŠ•ç¥¨åŒäºŒç»´ç 
                </label>
                <label style="display: block; font-size: 14px;">
                    <input type="radio" name="qrMode" value="vote" onchange="updateQRMode()">
                    ğŸ—³ï¸ ä»…æŠ•ç¥¨é¡µé¢
                </label>
            </div>
            
            <!-- WiFiå¯†ç è¾“å…¥(WiFiæ¨¡å¼æ—¶æ˜¾ç¤º) -->
            <div id="wifiPasswordInput" class="form-group" style="display:block; margin-bottom: 15px;">
                <input type="password" id="hotspotPassword" placeholder="è¯·è¾“å…¥WiFiçƒ­ç‚¹å¯†ç " 
                       style="width: 100%; padding: 10px; border: 2px solid white; border-radius: 8px; 
                              background: rgba(255,255,255,0.2); color: white; font-size: 14px;"
                       value="12345678">
                <small style="display: block; margin-top: 5px; opacity: 0.8;">éœ€è¦WiFiçƒ­ç‚¹å¯†ç æ‰èƒ½ç”Ÿæˆè¿æ¥äºŒç»´ç </small>
            </div>
            
            <!-- åŒäºŒç»´ç æ˜¾ç¤º -->
            <div id="comboQRDisplay" style="display:none;">
                <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px;">
                    <!-- WiFiäºŒç»´ç  -->
                    <div style="text-align: center; flex: 1; min-width: 200px; max-width: 300px;">
                        <div style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; padding: 12px; border-radius: 12px 12px 0 0; font-weight: bold;">
                            â‘  è¿æ¥WiFi
                        </div>
                        <div style="background: white; padding: 15px; border: 3px solid #4CAF50; border-top: none;">
                            <img id="comboWiFiImg" src="" alt="WiFiäºŒç»´ç " style="width: 100%; max-width: 200px;">
                        </div>
                        <div style="background: #f5f5f5; padding: 10px; border-radius: 0 0 12px 12px; font-size: 13px; color: #333;" id="wifiInfo">
                            WiFi: æŠ•ç¥¨æŠ½å¥–ç³»ç»Ÿ
                        </div>
                    </div>
                    
                    <!-- ç®­å¤´ -->
                    <div style="display: flex; align-items: center; font-size: 36px; color: rgba(255,255,255,0.8);">
                        â¡ï¸
                    </div>
                    
                    <!-- æŠ•ç¥¨äºŒç»´ç  -->
                    <div style="text-align: center; flex: 1; min-width: 200px; max-width: 300px;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 12px 12px 0 0; font-weight: bold;">
                            â‘¡ å‚ä¸æŠ•ç¥¨
                        </div>
                        <div style="background: white; padding: 15px; border: 3px solid #667eea; border-top: none;">
                            <img id="comboVoteImg" src="" alt="æŠ•ç¥¨äºŒç»´ç " style="width: 100%; max-width: 200px;">
                        </div>
                        <div style="background: #f5f5f5; padding: 10px; border-radius: 0 0 12px 12px; font-size: 13px; color: #333;" id="voteInfo">
                            æ‰“å¼€æŠ•ç¥¨é¡µé¢
                        </div>
                    </div>
                </div>
                
                <!-- ä½¿ç”¨è¯´æ˜ -->
                <div style="background: rgba(255, 243, 205, 0.3); border: 2px solid rgba(255, 193, 7, 0.5); border-radius: 12px; padding: 15px; margin-top: 15px;">
                    <div style="font-weight: bold; margin-bottom: 10px; font-size: 15px;">ğŸ“ ä½¿ç”¨è¯´æ˜ï¼š</div>
                    <div style="font-size: 14px; line-height: 1.8;">
                        <div>1ï¸âƒ£ ç”¨æ‰‹æœºç›¸æœºæ‰«æ<strong>å·¦ä¾§äºŒç»´ç </strong>ï¼Œç‚¹å‡»è¿æ¥WiFi</div>
                        <div>2ï¸âƒ£ è¿æ¥æˆåŠŸåï¼Œæ‰«æ<strong>å³ä¾§äºŒç»´ç </strong>æ‰“å¼€æŠ•ç¥¨é¡µé¢</div>
                        <div style="margin-top: 8px; font-size: 12px; opacity: 0.9;">ğŸ’¡ æ”¯æŒ Android 10+ / iOS 11+ è®¾å¤‡</div>
                    </div>
                </div>
            </div>
            
            <!-- å•ä¸ªäºŒç»´ç æ˜¾ç¤º -->
            <div id="qrcodeDisplay" class="qrcode-container" style="display:none;">
                <img id="qrcodeImg" src="" alt="äºŒç»´ç ">
                <div style="margin-top: 10px; font-size: 14px; color: #333;" id="qrcodeTip"></div>
            </div>
            
            <div class="qrcode-url" id="qrcodeUrl" style="display:none;"></div>
            
            <button class="qrcode-button" onclick="generateQRCode()" id="generateBtn">
                ç”ŸæˆäºŒç»´ç 
            </button>
            <div class="loading" id="loadingText" style="display:none;">æ­£åœ¨ç”Ÿæˆ...</div>
            <div class="loading" id="errorText" style="display:none; color: #ff6b6b;"></div>
        </div>
    </div>
    
    <div class="footer">
        <p>æŠ•ç¥¨æŠ½å¥–ç³»ç»Ÿ v1.0 | Powered by Python + Flask</p>
    </div>
    
    <script>
        // å½“å‰æ¨¡å¼ï¼šcombo / vote
        let currentMode = 'combo';
        
        // åˆ‡æ¢äºŒç»´ç æ¨¡å¼
        function updateQRMode() {
            const selectedMode = document.querySelector('input[name="qrMode"]:checked').value;
            currentMode = selectedMode;
            
            const wifiPasswordInput = document.getElementById('wifiPasswordInput');
            const qrcodeDisplay = document.getElementById('qrcodeDisplay');
            const comboQRDisplay = document.getElementById('comboQRDisplay');
            const qrcodeUrl = document.getElementById('qrcodeUrl');
            
            // æ ¹æ®æ¨¡å¼æ˜¾ç¤º/éšè—å¯†ç è¾“å…¥
            if (selectedMode === 'combo') {
                wifiPasswordInput.style.display = 'block';
            } else {
                wifiPasswordInput.style.display = 'none';
            }
            
            // æ¸…ç©ºä¹‹å‰çš„äºŒç»´ç 
            qrcodeDisplay.style.display = 'none';
            comboQRDisplay.style.display = 'none';
            qrcodeUrl.style.display = 'none';
        }
        
        // ç”ŸæˆäºŒç»´ç 
        function generateQRCode() {
            const generateBtn = document.getElementById('generateBtn');
            const loadingText = document.getElementById('loadingText');
            const errorText = document.getElementById('errorText');
            const qrcodeDisplay = document.getElementById('qrcodeDisplay');
            const comboQRDisplay = document.getElementById('comboQRDisplay');
            const qrcodeUrl = document.getElementById('qrcodeUrl');
            const qrcodeImg = document.getElementById('qrcodeImg');
            const qrcodeTip = document.getElementById('qrcodeTip');
            
            // éšè—é”™è¯¯ä¿¡æ¯
            errorText.style.display = 'none';
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            generateBtn.style.display = 'none';
            loadingText.style.display = 'block';
            
            let apiUrl = '';
            
            if (currentMode === 'combo') {
                // ç»„åˆæ¨¡å¼ï¼šç”ŸæˆWiFi+æŠ•ç¥¨åŒäºŒç»´ç 
                const password = document.getElementById('hotspotPassword').value.trim();
                if (!password) {
                    errorText.textContent = 'è¯·è¾“å…¥WiFiçƒ­ç‚¹å¯†ç ï¼';
                    errorText.style.display = 'block';
                    generateBtn.style.display = 'block';
                    loadingText.style.display = 'none';
                    return;
                }
                apiUrl = `/api/admin/qrcode/wifi-vote?password=${encodeURIComponent(password)}`;
            } else {
                // æŠ•ç¥¨æ¨¡å¼ï¼šä»…ç”ŸæˆæŠ•ç¥¨äºŒç»´ç 
                apiUrl = '/api/admin/qrcode/vote';
            }
            
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        if (currentMode === 'combo') {
                            // æ˜¾ç¤ºç»„åˆäºŒç»´ç 
                            document.getElementById('comboWiFiImg').src = `data:image/png;base64,${data.data.wifi_qrcode}`;
                            document.getElementById('comboVoteImg').src = `data:image/png;base64,${data.data.vote_qrcode}`;
                            document.getElementById('wifiInfo').textContent = data.data.wifi_info || 'WiFi: æŠ•ç¥¨æŠ½å¥–ç³»ç»Ÿ';
                            document.getElementById('voteInfo').textContent = data.data.vote_info || 'æ‰“å¼€æŠ•ç¥¨é¡µé¢';
                            comboQRDisplay.style.display = 'block';
                            qrcodeDisplay.style.display = 'none';
                            qrcodeUrl.style.display = 'none';
                        } else {
                            // æ˜¾ç¤ºå•ä¸ªäºŒç»´ç 
                            qrcodeImg.src = `data:image/png;base64,${data.data.qrcode}`;
                            qrcodeDisplay.style.display = 'block';
                            comboQRDisplay.style.display = 'none';
                            
                            // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                            qrcodeTip.innerHTML = 'ğŸ—³ï¸ æ‰«ææ­¤äºŒç»´ç è®¿é—®æŠ•ç¥¨é¡µé¢';
                            qrcodeUrl.textContent = data.data.url;
                            
                            qrcodeUrl.style.display = 'block';
                        }
                        
                        loadingText.style.display = 'none';
                    } else {
                        errorText.textContent = 'ç”Ÿæˆå¤±è´¥ï¼š' + (data.message || 'æœªçŸ¥é”™è¯¯');
                        errorText.style.display = 'block';
                        generateBtn.style.display = 'block';
                        loadingText.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('è¯·æ±‚å¤±è´¥:', error);
                    errorText.textContent = 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€å’Œç½‘ç»œè¿æ¥';
                    errorText.style.display = 'block';
                    generateBtn.style.display = 'block';
                    loadingText.style.display = 'none';
                });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨ç”ŸæˆäºŒç»´ç ï¼ˆå¯é€‰ï¼‰
        // window.addEventListener('load', generateQRCode);
    </script>
    <script>
        // è·å–æŠ•ç¥¨é…ç½®
        async function loadVoteConfig() {
            try {
                const response = await fetch('/api/vote/config');
                if (!response.ok) {
                    throw new Error('Failed to fetch vote config');
                }
                const config = await response.json();
                
                // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œä¸»æ ‡é¢˜
                if (config.vote_name && config.vote_name.trim()) {
                    document.getElementById('page-title').textContent = config.vote_name + ' - é¦–é¡µ';
                    document.getElementById('main-title').textContent = config.vote_name;
                }
            } catch (error) {
                console.error('Error loading vote config:', error);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè·å–æŠ•ç¥¨é…ç½®
        window.addEventListener('DOMContentLoaded', loadVoteConfig);
    </script>
</body>
</html>
